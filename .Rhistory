coefFR1=51.45 #micromol.m-2.s-1 per mV
coefPAR2=62.57 #micromol.m-2.s-1 per mV
coefFR2=33.16 #micromol.m-2.s-1 per mV
coefPAR0=10.0 #micromol.m-2.s-1 per mV
tableCoeff=data.frame(variable=c('Battery','PAR0','PAR1','PAR2','FR1','FR2'),
Coeff=c(1,coefPAR0,coefPAR1,coefPAR2,coefFR1,coefFR2))
## vector of info names in the RawData column
nbSlots=6
names=paste0(c('slot','value'),rep(x = c(1:nbSlots),each=2))
vecName= c('Logger',names)
tableSlot_C1=data.frame(Logger='C1',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
variable=c('Battery','PAR0','PAR0','PAR0','PAR0','PAR0'))
tableSlot_C2=data.frame(Logger='C2',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
variable=c('Battery','PAR0','PAR0','PAR2','FR2','sensor'))
tableSlot=rbind(tableSlot_C1,tableSlot_C2)
# load the data -----------------------------------------------------------
allDat=NULL #init
files=list.files(path = '0-data/',pattern = 'LOG')
for (file in files){
# file=files[1]
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file)
donF=merge(donF,tableSlot)
donF=merge(donF,tableCoeff)
allDat=rbind(allDat,donF)
}
View(allDat)
# Load packages -----------------------------------------------------------
packs <- c("lubridate", "stringr", 'tidyverse','viridis','data.table','cowplot','plotly')
InstIfNec<-function (pack) {
if (!do.call(require,as.list(pack))) {
do.call(install.packages,as.list(pack))  }
do.call(require,as.list(pack)) }
lapply(packs, InstIfNec)
coefPAR1=71.0 #micromol.m-2.s-1 per mV
coefFR1=51.45 #micromol.m-2.s-1 per mV
coefPAR2=62.57 #micromol.m-2.s-1 per mV
coefFR2=33.16 #micromol.m-2.s-1 per mV
coefPAR0=10.0 #micromol.m-2.s-1 per mV
tableCoeff=data.frame(variable=c('Battery','PAR0','PAR1','PAR2','FR1','FR2'),
Coeff=c(1,coefPAR0,coefPAR1,coefPAR2,coefFR1,coefFR2))
## vector of info names in the RawData column
nbSlots=6
names=paste0(c('slot','value'),rep(x = c(1:nbSlots),each=2))
vecName= c('Logger',names)
tableSlot_C1=data.frame(Logger='C1',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
variable=c('Battery','PAR0','PAR0','PAR0','PAR0','PAR0'))
tableSlot_C2=data.frame(Logger='C2',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
variable=c('Battery','PAR0','PAR0','PAR2','FR2','sensor'))
tableSlot=rbind(tableSlot_C1,tableSlot_C2)
allDat=NULL #init
files=list.files(path = '0-data/',pattern = 'LOG')
for (file in files){
# file=files[1]
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file)
donF=merge(donF,tableSlot)
donF=merge(donF,tableCoeff)
allDat=rbind(allDat,donF) %>%
mutate(value=tension*Coeff)
}
allDat %>%
filter(variable %in% c('PAR0')) %>%
ggplot(aes(x=time,y=value,col=sensor,group=DATA))+
geom_line()+
facet_wrap(~variable,scale='free_y')+
scale_x_datetime()+
labs(y='')
View(allDat)
allDat %>%
filter(variable %in% c('PAR0')) %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,logger)))+
geom_line()+
facet_wrap(~variable,scale='free_y')+
scale_x_datetime()+
labs(y='')
allDat %>%
filter(variable %in% c('PAR0')) %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_wrap(~variable,scale='free_y')+
scale_x_datetime()+
labs(y='')
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_wrap(~variable,scale='free_y')+
scale_x_datetime()+
labs(y='')
tableSlot_C2=data.frame(Logger='C2',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
var=c('Battery','PAR0','PAR0','PAR2','FR2','sensor'))
## vector of info names in the RawData column
nbSlots=6
names=paste0(c('slot','value'),rep(x = c(1:nbSlots),each=2))
vecName= c('Logger',names)
tableSlot_C1=data.frame(Logger='C1',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
var=c('Battery','PAR0','PAR0','PAR0','PAR0','PAR0'))
tableSlot_C2=data.frame(Logger='C2',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
var=c('Battery','PAR0','PAR0','PAR2','FR2','sensor'))
tableSlot=rbind(tableSlot_C1,tableSlot_C2)
tableSlot%>%
mutate(variable=str_remove(var,pattern ='[1,2,3,4]' ))
tableSlot%>%
mutate(variable=str_remove(var,pattern ='[0,1,2,3,4]' ))
runApp('App_Lora.R')
runApp('App_Lora.R')
runApp('App_Lora.R')
fileName
runApp('App_Lora.R')
runApp('App_Lora.R')
tableSlot=rbind(tableSlot_C1,tableSlot_C2)%>%
mutate(variable=str_remove(var,pattern ='[0,1,2,3,4]' ))
# SCRITP TO READ AND VISUALIZE THE DATA OF PAR SENSORS FROM THE PH --------
### R. PEREZ, 16 Mai 2024
# Load packages -----------------------------------------------------------
packs <- c("lubridate", "stringr", 'tidyverse','viridis','data.table','cowplot','plotly')
InstIfNec<-function (pack) {
if (!do.call(require,as.list(pack))) {
do.call(install.packages,as.list(pack))  }
do.call(require,as.list(pack)) }
lapply(packs, InstIfNec)
# inputs ------------------------------------------------------------------
### Apogee sensors coefficients
coefPAR1=71.0 #micromol.m-2.s-1 per mV
coefFR1=51.45 #micromol.m-2.s-1 per mV
coefPAR2=62.57 #micromol.m-2.s-1 per mV
coefFR2=33.16 #micromol.m-2.s-1 per mV
coefPAR0=10.0 #micromol.m-2.s-1 per mV
tableCoeff=data.frame(variable=c('Battery','PAR0','PAR1','PAR2','FR1','FR2'),
Coeff=c(1,coefPAR0,coefPAR1,coefPAR2,coefFR1,coefFR2))
## vector of info names in the RawData column
nbSlots=6
names=paste0(c('slot','value'),rep(x = c(1:nbSlots),each=2))
vecName= c('Logger',names)
# tableSlot_C1=data.frame(Logger='C1',
#                        sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
#                      variable=c('Battery','PAR0','PAR0','PAR0','PAR0','PAR0'))
#
# tableSlot_C2=data.frame(Logger='C2',
#                         sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
#                         variable=c('Battery','PAR0','PAR0','PAR2','FR2','sensor'))
tableSlot_C1=data.frame(Logger='C1',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
variable=c('Battery','PAR0','PAR0','PAR0','PAR0','PAR0'))
tableSlot_C2=data.frame(Logger='C2',
sensor=c("T0 S2","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
variable=c('Battery','PAR0','PAR0','PAR0','PAR0','PAR0'))
tableSlot=rbind(tableSlot_C1,tableSlot_C2)
# load the data -----------------------------------------------------------
allDat=NULL #init
files=list.files(path = '0-data/',pattern = 'chap4')
for (file in files){
# file=files[1]
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file)
donF=merge(donF,tableSlot)
donF=merge(donF,tableCoeff)
allDat=rbind(allDat,donF) %>%
mutate(value=tension*Coeff)
}
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_wrap(~variable,scale='free_y')+
scale_x_datetime()+
labs(y='')
allDat
nbSlots
tableSlot
allDat=NULL #init
files=list.files(path = '0-data/',pattern = 'chap4')
files
files=list.files(path = '0-data/',pattern = 'Chap4')
files
for (file in files){
# file=files[1]
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file)
donF=merge(donF,tableSlot)
donF=merge(donF,tableCoeff)
allDat=rbind(allDat,donF) %>%
mutate(value=tension*Coeff)
}
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_wrap(~variable,scale='free_y')+
scale_x_datetime()+
labs(y='')
View(allDat)
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_wrap(logger~variable,scale='free_y')+
scale_x_datetime()+
labs(y='')
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_wrap(Logger~variable,scale='free_y')+
scale_x_datetime()+
labs(y='')
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_wrap(Logger~sensor,scale='free_y')+
scale_x_datetime()+
labs(y='')
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_grid(Logger~sensor,scale='free_y')+
scale_x_datetime()+
labs(y='')
View(don_raw)
test1=allDat %>%filter(Logger=='C1')
View(test1)
test2=allDat %>%filter(Logger=='C2')
View(test2)
don_raw=data.table::fread(input = paste0('0-data/',file))
View(don_raw)
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
View(don_raw)
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
View(don_raw)
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
View(dsub)
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file)
View(donF)
View(donF)
don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11'))
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file)
View(donF)
View(don)
View(dsub)
colnames(dsub)[colnames(dsub)=='info']
View(don)
View(don_raw)
names(don)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select('Logger',paste0('info',i)))
}
View(dsub)
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file)
View(donF)
View(don)
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_')
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file,
Logger=str_sub(COM,1,2))
View(donF)
allDat=NULL #init
files=list.files(path = '0-data/',pattern = 'Chap4')
for (file in files){
# file=files[1]
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file,
Logger=str_sub(COM,1,2))
donF=merge(donF,tableSlot)
donF=merge(donF,tableCoeff)
allDat=rbind(allDat,donF) %>%
mutate(value=tension*Coeff)
}
test1=allDat %>%filter(Logger=='C1')
test2=allDat %>%filter(Logger=='C2')
View(test1)
test2=allDat %>%filter(Logger=='C2')
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_grid(Logger~sensor,scale='free_y')+
scale_x_datetime()+
labs(y='')
View(allDat)
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
View(don_raw)
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
View(don)
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file,
Logger=str_sub(COM,1,2))
View(donF)
donF=merge(donF,tableSlot)
View(donF)
tableSlot
tableSlot_C1=data.frame(Logger='C1',
sensor=c("T0 S4","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
variable=c('Battery','PAR0','PAR0','PAR0','PAR0','PAR0'))
tableSlot_C2=data.frame(Logger='C2',
sensor=c("T0 S4","T1 S1","T2 S1","T3 S1","T4 S1","T5 S1"),
variable=c('Battery','PAR0','PAR0','PAR0','PAR0','PAR0'))
tableSlot=rbind(tableSlot_C1,tableSlot_C2)
allDat=NULL #init
files=list.files(path = '0-data/',pattern = 'Chap4')
for (file in files){
# file=files[1]
don_raw=data.table::fread(input = paste0('0-data/',file)) %>%
mutate(Date=dmy(Date),
time=ymd_hms(paste(Date,Heure)),
ref=str_sub(COM,start=1,end=str_length(COM)-1)) %>%
tidyr::separate(col = ref,into =vecName ,sep='#')
don=don_raw %>% select(Date,Heure,time,COM)
for (i in 1: nbSlots){
dsub=don_raw %>%
mutate(info=paste(get(paste0('slot',i)),get(paste0('value',i))))
colnames(dsub)[colnames(dsub)=='info']=paste0('info',i)
don=cbind(don,dsub %>%
select(paste0('info',i)))
}
donF=don %>%
tidyr::gather(key = 'info',value = 'value',contains('info')) %>%
mutate(value=str_remove(value,'_A11')) %>%
tidyr::separate(col = value,into = c('sensor','tension'),sep = '_') %>%
mutate(tension=as.numeric(tension),
DATA=file,
Logger=str_sub(COM,1,2))
donF=merge(donF,tableSlot)
donF=merge(donF,tableCoeff)
allDat=rbind(allDat,donF) %>%
mutate(value=tension*Coeff)
}
allDat %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_grid(Logger~sensor,scale='free_y')+
scale_x_datetime()+
labs(y='')
View(allDat)
allDat %>%
filter(variable=='PAR0') %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_grid(Logger~sensor,scale='free_y')+
scale_x_datetime()+
labs(y='')
allDat %>%
filter(variable=='Battery') %>%
ggplot(aes(x=time,y=value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_grid(Logger~sensor,scale='free_y')+
scale_x_datetime()+
labs(y='')
allDat %>%
filter(variable=='Battery') %>%
ggplot(aes(x=time,y=-value,col=sensor,group=paste(sensor,Logger)))+
geom_line()+
facet_grid(Logger~sensor,scale='free_y')+
scale_x_datetime()+
labs(y='')
